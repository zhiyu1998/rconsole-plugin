name: Auto Reply to Pull Requests

on:
  pull_request:
    types: [opened]

jobs:
  auto-reply:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
    steps:
      - name: Reply to PR
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = context.issue.number;
            const prTitle = context.payload.pull_request.title;
            const prAuthor = context.payload.pull_request.user.login;
            const prFiles = context.payload.pull_request.changed_files;
            
            let replyMessage = `ğŸ‰ Hi @${prAuthor}! 
            
            æ„Ÿè°¢æ‚¨çš„è´¡çŒ®ï¼æ‚¨çš„Pull Requestå·²ç»æäº¤ï¼Œæˆ‘ä»¬ä¼šå°½å¿«è¿›è¡Œä»£ç å®¡æ ¸ã€‚
            
            ## ğŸ“‹ å®¡æ ¸æ¸…å•
            æœŸé—´è¯·ç¡®ä¿ä»¥ä¸‹é¡¹ç›®å·²å®Œæˆï¼š
            - [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒå’Œé£æ ¼
            - [ ] å·²æµ‹è¯•æ–°åŠŸèƒ½æˆ–ä¿®å¤
            - [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰
            - [ ] æäº¤ä¿¡æ¯æ¸…æ™°æ˜ç¡®
            
            ## ğŸ“Š PR ç»Ÿè®¡
            - ğŸ“ ä¿®æ”¹æ–‡ä»¶æ•°ï¼š${prFiles}
            - ğŸ·ï¸ PRç±»å‹ï¼š${prTitle.toLowerCase().includes('fix') ? 'ğŸ› Bugä¿®å¤' : 
                            prTitle.toLowerCase().includes('feat') ? 'âœ¨ æ–°åŠŸèƒ½' :
                            prTitle.toLowerCase().includes('doc') ? 'ğŸ“– æ–‡æ¡£æ›´æ–°' :
                            prTitle.toLowerCase().includes('refactor') ? 'â™»ï¸ é‡æ„' : 'ğŸ”§ å…¶ä»–æ”¹è¿›'}
            
            ## ğŸ”„ ä¸‹ä¸€æ­¥
            æˆ‘ä»¬ä¼šåœ¨1-3ä¸ªå·¥ä½œæ—¥å†…å®Œæˆåˆæ­¥å®¡æ ¸ã€‚å¦‚æœ‰é—®é¢˜ä¼šåŠæ—¶ä¸æ‚¨æ²Ÿé€šã€‚
            
            å†æ¬¡æ„Ÿè°¢æ‚¨å¯¹é¡¹ç›®çš„è´¡çŒ®ï¼ ğŸ™`;
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              body: replyMessage
            });
      
      - name: Add PR Labels
        uses: actions/github-script@v7
        with:
          script: |
            const prTitle = context.payload.pull_request.title.toLowerCase();
            const labels = [];
            
            // æ ¹æ®PRæ ‡é¢˜è‡ªåŠ¨æ·»åŠ æ ‡ç­¾
            if (prTitle.includes('fix') || prTitle.includes('ä¿®å¤')) {
              labels.push('bug');
            }
            if (prTitle.includes('feat') || prTitle.includes('åŠŸèƒ½') || prTitle.includes('add')) {
              labels.push('enhancement');
            }
            if (prTitle.includes('doc') || prTitle.includes('æ–‡æ¡£')) {
              labels.push('documentation');
            }
            if (prTitle.includes('refactor') || prTitle.includes('é‡æ„')) {
              labels.push('refactor');
            }
            if (prTitle.includes('test') || prTitle.includes('æµ‹è¯•')) {
              labels.push('test');
            }
            
            // æ ¹æ®æ–‡ä»¶æ•°é‡æ·»åŠ å¤§å°æ ‡ç­¾
            const fileCount = context.payload.pull_request.changed_files;
            if (fileCount <= 3) {
              labels.push('size/small');
            } else if (fileCount <= 10) {
              labels.push('size/medium');
            } else {
              labels.push('size/large');
            }
            
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                labels: labels
              });
            }